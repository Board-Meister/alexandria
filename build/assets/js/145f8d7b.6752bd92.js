"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[1226],{5235:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"marshal/scope/aliasing","title":"Aliasing","description":"When using scoped global variables it might be inconvenient to use them over the old way. We have to add additional","source":"@site/docs/marshal/scope/aliasing.md","sourceDirName":"marshal/scope","slug":"/marshal/scope/aliasing","permalink":"/docs/marshal/scope/aliasing","draft":false,"unlisted":false,"editUrl":"https://github.com/Board-Meister/alexandria/blob/master/docs/marshal/scope/aliasing.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Aliasing"},"sidebar":"tutorialSidebar","previous":{"title":"Creating scope","permalink":"/docs/marshal/scope/"},"next":{"title":"Obscure libraries","permalink":"/docs/marshal/scope/obscure"}}');var a=n(4848),o=n(8453);const s={sidebar_position:2,sidebar_label:"Aliasing"},i="Aliasing",l={},c=[{value:"Easy to use hard to maintain",id:"easy-to-use-hard-to-maintain",level:2},{value:"Tips on creating alias map",id:"tips-on-creating-alias-map",level:2}];function d(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"aliasing",children:"Aliasing"})}),"\n",(0,a.jsx)(t.p,{children:"When using scoped global variables it might be inconvenient to use them over the old way. We have to add additional\r\nline to tell TS about each new global variable and actually have two names for each of them."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="plugin.ts"',children:"// We have to define this import as just definition import otherwise we will be including\r\n// whole copy of styled-components library even if we are not using it (and all its dependencies)\r\nimport type styledComponents from 'styled-components'   // !!! Additional name !!!\r\n\r\n// We have to declare this variable in each file otherwise Typescript validator will throw an exception\r\n// regarding using non existing variable\r\ndeclare const styled: typeof styledComponents;          // !!! Additional line !!!\r\n\r\n// And finally we can use the library without getting errors from TS\r\nconst Div = styled.div`\r\n    background-color: red;\r\n`\n"})}),"\n",(0,a.jsxs)(t.p,{children:["A way to overcome this DX issue is to tell your bundler about global variable. This can be done in a lot different ways\r\nper each bundler but to have concrete example we will focus on ",(0,a.jsx)(t.code,{children:"esbuild"})," as our main bundler."]}),"\n",(0,a.jsxs)(t.p,{children:["Even though ",(0,a.jsx)(t.code,{children:"esbuild"})," has its own properties to allow for such endeavors like ",(0,a.jsx)(t.code,{children:"external"})," or ",(0,a.jsx)(t.code,{children:"alias"})," I found them\r\nsomewhat lacking and settled for an alias plugin ",(0,a.jsx)(t.code,{children:"esbuild-plugin-path-alias"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"npm i -D esbuild-plugin-path-alias\n"})}),"\n",(0,a.jsxs)(t.p,{children:["With this installed we can easily alias any package however we want. Lets create a aliasing file for the\r\n",(0,a.jsx)(t.code,{children:"styled-components"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="styled-components.alias.ts"',children:'import type Styled from "styled-components";\r\n\r\ndeclare const styled: typeof Styled;\r\n\r\nexport default styled;\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Notice how similar this is to what we did in ",(0,a.jsx)(t.code,{children:"plugin.ts"}),". We just moved this repeating definition into one place which\r\nwill tell our bundler how to understand all our usages of this library."]}),"\n",(0,a.jsxs)(t.p,{children:["But what exactly is happening here? In this file we specified the name of the global variable ",(0,a.jsx)(t.code,{children:"styled"}),", what are its\r\ncontents (",(0,a.jsx)(t.code,{children:"styled-components"}),") and how it is exported (",(0,a.jsx)(t.code,{children:"default"}),")."]}),"\n",(0,a.jsxs)(t.p,{children:["With this we can use our plugin to specify how ",(0,a.jsx)(t.code,{children:"styled-components"})," should be resolved during bundling."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="esbuild.config.mjs"',children:"import aliasPlugin from 'esbuild-plugin-path-alias';\r\n\r\naliasPlugin({\r\n    'styled-components': '/absolute/path/styled.alias',\r\n}),\n"})}),"\n",(0,a.jsx)(t.p,{children:"With this in place we can come back to our old habits:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="plugin.ts"',children:"import styled from 'styled-components'\r\n\r\nconst Div = styled.div`\r\n    background-color: red;\n"})}),"\n",(0,a.jsx)(t.p,{children:"and stop worrying about duplicating this library."}),"\n",(0,a.jsx)(t.admonition,{title:"Do not create additional alias maps",type:"warning",children:(0,a.jsx)(t.p,{children:"If you are not a creator of related scope plugin it is highly possible for them to have already prepared aliasing file\r\nready for you to use. Check out their library for such files and do not burden yourself unnecessarily."})}),"\n",(0,a.jsx)(t.h2,{id:"easy-to-use-hard-to-maintain",children:"Easy to use hard to maintain"}),"\n",(0,a.jsx)(t.p,{children:"For better experience library creators export their work in few different ways to make our life easier. If you want to\r\ncreate a proper alias map you have to completely mimic their way of exporting. Lets take for example React library,\r\nit does not only export React but also each of its methods separately, so we can write:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"import { useState } from 'react'\r\nconst [loading, setLoading] = useState(false);\n"})}),"\n",(0,a.jsx)(t.p,{children:"instead of"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"import React from 'react'\r\n\r\nconst { useState } = React;\r\nconst [loading, setLoading] = useState(false);\n"})}),"\n",(0,a.jsx)(t.p,{children:"because of that we have to mimic their way of exporting to the letter. Here is a working example of export for\r\nReact 18.3.1:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="react.alias.ts"',children:"import type React from 'react';\r\n\r\ndeclare const react: typeof React;\r\n\r\nexport const Children = react.Children\r\nexport const Component = react.Component\r\nexport const Fragment = react.Fragment\r\nexport const Profiler = react.Profiler\r\nexport const PureComponent = react.PureComponent\r\nexport const StrictMode = react.StrictMode\r\nexport const Suspense = react.Suspense\r\nexport const cloneElement = react.cloneElement\r\nexport const createContext = react.createContext\r\nexport const createElement = react.createElement\r\nexport const createFactory = react.createFactory\r\nexport const createRef = react.createRef\r\nexport const forwardRef = react.forwardRef\r\nexport const isValidElement = react.isValidElement\r\nexport const lazy = react.lazy\r\nexport const memo = react.memo\r\nexport const startTransition = react.startTransition\r\nexport const useCallback = react.useCallback\r\nexport const useContext = react.useContext\r\nexport const useDebugValue = react.useDebugValue\r\nexport const useDeferredValue = react.useDeferredValue\r\nexport const useEffect = react.useEffect\r\nexport const useId = react.useId\r\nexport const useImperativeHandle = react.useImperativeHandle\r\nexport const useInsertionEffect = react.useInsertionEffect\r\nexport const useLayoutEffect = react.useLayoutEffect\r\nexport const useMemo = react.useMemo\r\nexport const useReducer = react.useReducer\r\nexport const useRef = react.useRef\r\nexport const useState = react.useState\r\nexport const useSyncExternalStore = react.useSyncExternalStore\r\nexport const useTransition = react.useTransition\r\nexport const version = react.version\r\n// @ts-expect-error TS2339: Property does not exist\r\nexport const unstable_act = react.unstable_act\r\n// @ts-expect-error TS2339: Property does not exist\r\nexport const __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED = react.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED\r\n\r\nexport default react;\n"})}),"\n",(0,a.jsx)(t.p,{children:"Notice how we have two exports that TS does not know about but are actually required for libraries like React DOM to\r\nwork."}),"\n",(0,a.jsx)(t.p,{children:"Notice how big of export map it is and its not the biggest one up there - hence the tip:"}),"\n",(0,a.jsx)(t.admonition,{title:"Maybe it is not worth it",type:"tip",children:(0,a.jsx)(t.p,{children:"If your plugin uses the global variable once or twice it might not be worth the effort to create such map. There are\r\neven cases where using the map actually increased the size of the application."})}),"\n",(0,a.jsx)(t.h2,{id:"tips-on-creating-alias-map",children:"Tips on creating alias map"}),"\n",(0,a.jsx)(t.p,{children:"If you decided after careful consideration that your benefits are big enough, here are some tips for creating maps of\r\nsuch size:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Always export whole library as a default, it can't hurt."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"To get real export (without TS exclusive exports like Interfaces, declarations etc.) just log it to the console. It\r\ncan't get more real then actual object in browser. Here is a function to create such map from logged variable:"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"function createAliasMap(variable, vName) {\r\n    return Object.keys(variable)\r\n        .reduce((a, c) => `${a}export const ${c} = ${vName}.${c};\\n`, '')\r\n    ;\r\n}\n"})})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var r=n(6540);const a={},o=r.createContext(a);function s(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);